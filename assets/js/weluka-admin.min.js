(function(a,g){var c={postInfo:{postId:"",postType:"",adminUrl:welukaWp.admin_url,editScriptUrl:welukaWp.admin_url+"post.php?post={{postId}}&action=edit"},_init:function(){c._setBindEvents();c._redirectCheck()},_setBindEvents:function(){if(a("#weluka-builder-button").length)a("#weluka-builder-button").on("click",{objName:"#weluka-builder-button"},c._renderContent);if(a("#weluka-builder-content-iframe").length)a("#weluka-builder-content-iframe").on("load",{objName:"#weluka-builder-content-iframe"},
c._iframeLoad);a(window).on("resize",c._windowResize);if(a("#weluka-builder-close").length)a("#weluka-builder-close").on("click",c._builderClose);if(a("#weluka-builder-save").length)a("#weluka-builder-save").on("click",{mode:"save"},c._save);if(a("#weluka-builder-publish").length)a("#weluka-builder-publish").on("click",{mode:"publish"},c._save);if(a("#weluka-builder-preview").length)a("#weluka-builder-preview").on("click",c._preview);a("#weluka-save-editor-content").on("click",c._tinymceModalSave);
a(".weluka-modal").on("hidden.bs.modal",c._modalClose)},_redirectCheck:function(){var b={};if(1<window.location.search.length)for(var c=window.location.search.substring(1).split("&"),e=0;e<c.length;e++){var f=c[e].split("="),h=decodeURIComponent(f[0]),f=decodeURIComponent(f[1]);b[h]=f}"undefined"!=typeof b.weluka_redirect&&b.weluka_redirect&&a("#weluka-builder-button").click()},_renderContent:function(b){if(a("body").hasClass("weluka-builder-enabled")){var d=a(b.data.objName).data("post"),e=a(b.data.objName).data("new");
b=a(b.data.objName).data("postType");c.postInfo.postId=d;c.postInfo.postType=b;a.ajax({type:"post",async:!1,url:welukaWp.ajax_url,data:{action:"weluka_get_site_content",nonce:welukaWp.nonces.weluka_get_site_content,postId:d,newFlg:e},dataType:"json",error:function(a,b,c){console.log(c.message)},success:function(b){a("#weluka-builder").length&&(c._propWpDom(!1),a("#weluka-builder").css("display","block"),a("#weluka-builder-content-iframe")[0].contentDocument.location.replace(b.editUrl))}})}},_propWpDom:function(b){b?
(a("#footer, #adminmenuwrap, #adminmenuback, .update-nag, #wpcontent > #wpbody, #wpfooter").removeClass("weluka-hide"),a(window).trigger("resize")):a("#footer, #adminmenuwrap, #adminmenuback, .update-nag, #wpcontent > #wpbody, #wpfooter").addClass("weluka-hide")},_iframeLoad:function(a){c._windowResize()},_windowResize:function(){var b=a("#wpadminbar").length?a("#wpadminbar").outerHeight():0,c=a("#weluka-builder-navbar").length?a("#weluka-builder-navbar").outerHeight():0,e=window.innerHeight?window.innerHeight:
a(window).height();a("#weluka-builder-content-wrapper").height(e-b-c-4)},_builderClose:function(){if(confirm(welukaWp.msgs.close_confirm_msg)){var a=c.postInfo.editScriptUrl.replace("{{postId}}",c.postInfo.postId);location.replace(a)}},_save:function(b){if(a("body").hasClass("weluka-builder-enabled")){var d="save";b&&"undefined"!=typeof b.data.mode&&(d=b.data.mode?b.data.mode:"save");b=a("#weluka-builder-content-iframe")[0].contentWindow.welukaContentModel?a("#weluka-builder-content-iframe")[0].contentWindow.welukaContentModel:
{};b=JSON.stringify(b);("{}"!=b&&"[]"!=b&&-1===b.indexOf('{"sections":[]')||confirm(welukaWp.msgs.content_null_save_confirm_msg))&&a.ajax({type:"post",async:!1,url:welukaWp.ajax_url,scriptCharset:"utf-8",data:{action:"weluka_save_content",nonce:welukaWp.nonces.weluka_save_content,mode:d,postId:c.postInfo.postId,saveData:b},dataType:"json",error:function(a,b,c){console.log(c.message)},success:function(b){""!=b.msg?console.log(b.msg):(b=a("form#post #title"),"undefined"!==typeof b&&""==b.val()&&b.val("Post #"+
c.postInfo.postId),a("form#post").append('<input type="hidden" name="weluka-builder-editon" value="true" />'),"layoutsel"==d?a("form#post").append('<input type="hidden" id="weluka-builder-layout-select" name="weluka-builder-layout-select" value="true" />'):a("#weluka-builder-layout-select").length&&a("#weluka-builder-layout-select").remove(),"publish"===d?a("form#post #publish").click():a("form#post").submit())}})}},_preview:function(){var b=a("#weluka-builder-content-iframe")[0].contentWindow.welukaContentModel?
a("#weluka-builder-content-iframe")[0].contentWindow.welukaContentModel:{},b=JSON.stringify(b);a.ajax({type:"post",async:!1,url:welukaWp.ajax_url,scriptCharset:"utf-8",data:{action:"weluka_save_content",nonce:welukaWp.nonces.weluka_save_content,mode:"preview",postId:c.postInfo.postId,saveData:b},dataType:"json",error:function(a,b,c){console.log(c.message)},success:function(b){""!=b.msg?console.log(b.msg):a("form#post #post-preview").click()}})},_tinymceModalSave:function(){var b=a("#weluka-code-editor-modal"),
d="",d=a("#wp-welukacodeeditorcontent-wrap").hasClass("tmce-active")?tinyMCE.get("welukacodeeditorcontent").getContent():jQuery("#welukacodeeditorcontent").val();a("#weluka-builder-content-iframe")[0].contentWindow.welukaBuilder.tinymceSaved(d);c._modalClose();b.modal("hide")},_modalClose:function(){a(".mce-inline-toolbar-grp").css("display","none")}},k={tinymceModalOpen:function(b){var c=a("#weluka-code-editor-modal");c.removeClass("hide");c.modal("show");"undefined"!==typeof tinyMCE?setTimeout(function(){a("#wp-welukacodeeditorcontent-wrap").hasClass("tmce-active")?
(tinyMCE.get("welukacodeeditorcontent").focus(),tinyMCE.activeEditor.setContent(b)):(a("#welukacodeeditorcontent").focus(),a("#welukacodeeditorcontent").val(b));wp&&wp.media&&wp.media.editor&&wp.media.editor.open("welukacodeeditorcontent").close()},500):alert("tinymce undefined")},getCurrentPostId:function(){return c.postInfo.postId},saveReload:function(a){c._save(a)}};a(document).ready(function(){g.welukaAdmin=k;c._init()})})(jQuery,this);